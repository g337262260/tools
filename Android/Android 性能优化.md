# Android 性能优化

## 启动速度优化

### 启动方式

- 冷启动

  在Android 系统中，系统给每个应用至少分配了一个进程。从进程角度上说就是，没有该应用的进程消息（activity 或者是 service）。比如就是设备开机后应用的第一次启动，系统杀掉进程后的再次启动。在这种方式下，应用的启动时间最长，需要做的工作也是最多的。

  应用在发生冷启动的时候系统需要做的工作：

  1. 开始加载并启动应用
  2. 应用启动后，显示一个空白的启动窗口
  3. 创建应用进程信息

  系统创建应用后，应用需要做的工作：

  1. 初始化应用中的对象
  2. 启动主线程（UI线程）
  3. 创建第一个Acticity
  4. 加载内容视图（Inflating）
  5. 计算视图在屏幕上的排版位置（Laying out）
  6. 绘制视图（Draw）

  只有在视图绘制完成后，系统当前展示的空白背景才会消失，才会被Acticity的内容视图替换掉，用户才可以开始交互。

- 暖启动

  当应用中的Activities被销毁，但是在内存中常驻的时候，应用的启动方式就会变为暖启动。相比于冷启动，减少了对象初始化以及布局加载的时间，但启动的时候，依然会有一个白色的背景，直到第一个Acticity 的内容出现为止。

- 热启动

  热启动时，应用做的工作更少，启动时间更短。比如用户使用返回键退出应用，然后马上有重新启动应用。

### 解决方案

1. 利用提前展示出来的window，快速展出来一个界面，给用户快速反馈的体验。
   - 启动加速-主题切换
2. 避免在启动时做密集沉重的初始化（Heavy app initialization）
   - 将一些第三方的组件放到WorkThread中初始化
   - 延迟地图定位，自有统计等组件的初始化
3. 定位问题：避免I/O操作、反序列化、网络操作、布局嵌套等。
   - 数据库及IO操作都移到工作线程，并设置优先级为：THREAD_PRIORITY_BACKGROUND,有限保证主线程执行
   - 流程梳理，延后执行
   - 去掉无用、逻辑重复代码

## UI 流畅度优化

### 布局优化

> 60帧每秒是目前最合适的图像显示速度，为了让屏幕的刷新帧达到60fps，我们需要确保在16ms内完成单次刷新的操作。

- 过度重绘

  在开发者选项中开启GPU过度绘制，显示过度绘制区域。

- 减少嵌套层次及控件个数

- Merge 标签